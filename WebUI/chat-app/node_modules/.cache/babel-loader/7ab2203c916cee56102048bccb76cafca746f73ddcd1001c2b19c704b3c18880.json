{"ast":null,"code":"'use strict';\n\nvar defer = require('./').defer;\nvar states = {\n  high: new Set(['low']),\n  low: new Set(['high'])\n};\n/**\n * Construct a {@link Latch}.\n * @class\n * @classdesc A {@link Latch} has two states (\"high\" and \"low\") and methods for\n * transitioning between them ({@link Latch#raise} and {@link Latch#lower}).\n * @param {string} [initialState=\"low\"] - either \"high\" or \"low\"\n */\nvar Latch = /** @class */function () {\n  function Latch(initialState) {\n    if (initialState === void 0) {\n      initialState = 'low';\n    }\n    var state = initialState;\n    Object.defineProperties(this, {\n      _state: {\n        set: function (_state) {\n          var _this = this;\n          if (state !== _state) {\n            state = _state;\n            var whenDeferreds = this._whenDeferreds.get(state);\n            whenDeferreds.forEach(function (deferred) {\n              return deferred.resolve(_this);\n            });\n            whenDeferreds.clear();\n          }\n        },\n        get: function () {\n          return state;\n        }\n      },\n      _whenDeferreds: {\n        value: new Map([['high', new Set()], ['low', new Set()]])\n      }\n    });\n  }\n  Object.defineProperty(Latch.prototype, \"state\", {\n    get: function () {\n      return this._state;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * Transition to \"low\".\n   * @returns {this}\n   * @throws {Error}\n   */\n  Latch.prototype.lower = function () {\n    return this.transition('low');\n  };\n  /**\n   * Transition to \"high\".\n   * @returns {this}\n   * @throws {Error}\n   */\n  Latch.prototype.raise = function () {\n    return this.transition('high');\n  };\n  /**\n   * Transition to a new state.\n   * @param {string} newState\n   * @returns {this}\n   * @throws {Error}\n   */\n  Latch.prototype.transition = function (newState) {\n    if (!states[this.state].has(newState)) {\n      throw createUnreachableStateError(this.state, newState);\n    }\n    this._state = newState;\n    return this;\n  };\n  /**\n   * Return a Promise that resolves when the {@link Latch} transitions to\n   * the specified state.\n   * @param {string} state\n   * @returns {Promise<this>}\n   */\n  Latch.prototype.when = function (state) {\n    if (this.state === state) {\n      return Promise.resolve(this);\n    }\n    if (!states[this.state].has(state)) {\n      return Promise.reject(createUnreachableStateError(this.state, state));\n    }\n    var deferred = defer();\n    this._whenDeferreds.get(state).add(deferred);\n    return deferred.promise;\n  };\n  return Latch;\n}();\n/**\n   * Create an unreachable state Error.\n   * @param {string} from - state to be transitioned from\n   * @param {string} to - state to be transitioned to\n   * @return {Error}\n   */\nfunction createUnreachableStateError(from, to) {\n  return new Error(\"Cannot transition from \\\"\" + from + \"\\\" to \\\"\" + to + \"\\\"\");\n}\nmodule.exports = Latch;","map":{"version":3,"names":["defer","require","states","high","Set","low","Latch","initialState","state","Object","defineProperties","_state","set","_this","whenDeferreds","_whenDeferreds","get","forEach","deferred","resolve","clear","value","Map","defineProperty","prototype","lower","transition","raise","newState","has","createUnreachableStateError","when","Promise","reject","add","promise","from","to","Error","module","exports"],"sources":["/home/denis/RiderProjects/ChatRoulette/WebUI/chat-app/node_modules/twilio-video/lib/webrtc/util/latch.js"],"sourcesContent":["'use strict';\n\nconst { defer } = require('./');\n\nconst states = {\n  high: new Set(['low']),\n  low: new Set(['high'])\n};\n\n/**\n * Construct a {@link Latch}.\n * @class\n * @classdesc A {@link Latch} has two states (\"high\" and \"low\") and methods for\n * transitioning between them ({@link Latch#raise} and {@link Latch#lower}).\n * @param {string} [initialState=\"low\"] - either \"high\" or \"low\"\n */\nclass Latch {\n  constructor(initialState = 'low') {\n    let state = initialState;\n    Object.defineProperties(this, {\n      _state: {\n        set: function(_state) {\n          if (state !== _state) {\n            state = _state;\n            const whenDeferreds = this._whenDeferreds.get(state);\n            whenDeferreds.forEach(deferred => deferred.resolve(this));\n            whenDeferreds.clear();\n          }\n        },\n        get: function() {\n          return state;\n        }\n      },\n      _whenDeferreds: {\n        value: new Map([\n          ['high', new Set()],\n          ['low', new Set()]\n        ])\n      }\n    });\n  }\n\n  get state() {\n    return this._state;\n  }\n\n  /**\n   * Transition to \"low\".\n   * @returns {this}\n   * @throws {Error}\n   */\n  lower() {\n    return this.transition('low');\n  }\n\n  /**\n   * Transition to \"high\".\n   * @returns {this}\n   * @throws {Error}\n   */\n  raise() {\n    return this.transition('high');\n  }\n\n  /**\n   * Transition to a new state.\n   * @param {string} newState\n   * @returns {this}\n   * @throws {Error}\n   */\n  transition(newState) {\n    if (!states[this.state].has(newState)) {\n      throw createUnreachableStateError(this.state, newState);\n    }\n    this._state = newState;\n    return this;\n  }\n\n  /**\n   * Return a Promise that resolves when the {@link Latch} transitions to\n   * the specified state.\n   * @param {string} state\n   * @returns {Promise<this>}\n   */\n  when(state) {\n    if (this.state === state) {\n      return Promise.resolve(this);\n    }\n    if (!states[this.state].has(state)) {\n      return Promise.reject(createUnreachableStateError(this.state, state));\n    }\n    const deferred = defer();\n    this._whenDeferreds.get(state).add(deferred);\n    return deferred.promise;\n  }\n}\n\n/**\n   * Create an unreachable state Error.\n   * @param {string} from - state to be transitioned from\n   * @param {string} to - state to be transitioned to\n   * @return {Error}\n   */\nfunction createUnreachableStateError(from, to) {\n  return new Error(`Cannot transition from \"${from}\" to \"${to}\"`);\n}\n\nmodule.exports = Latch;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
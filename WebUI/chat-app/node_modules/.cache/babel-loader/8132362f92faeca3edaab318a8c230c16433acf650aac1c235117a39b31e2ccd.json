{"ast":null,"code":"'use strict';\n\n/**\n * The {@link DocumentVisibilityMonitor} monitors the visibility state of the DOM\n * and executes the attached listeners in phase order when the DOM is visible.\n */\nvar DocumentVisibilityMonitor = /** @class */function () {\n  /**\n   * Constructor.\n   * @param {number} [nPhases=1] - the number of phases\n   */\n  function DocumentVisibilityMonitor(nPhases) {\n    var _this = this;\n    if (nPhases === void 0) {\n      nPhases = 1;\n    }\n    Object.defineProperties(this, {\n      _listeners: {\n        value: []\n      },\n      _onVisibilityChange: {\n        value: function () {\n          _this._emitVisible(document.visibilityState === 'visible');\n        }\n      }\n    });\n    for (var i = 0; i < nPhases; i++) {\n      this._listeners.push([]);\n    }\n  }\n  /**\n   * clears the state.\n   */\n  DocumentVisibilityMonitor.prototype.clear = function () {\n    var nPhases = this._listeners.length;\n    for (var i = 0; i < nPhases; i++) {\n      this._listeners[i] = [];\n    }\n  };\n  DocumentVisibilityMonitor.prototype._listenerCount = function () {\n    return this._listeners.reduce(function (count, phaseListeners) {\n      return count + phaseListeners.length;\n    }, 0);\n  };\n  /**\n   * Call all the listeners. Makes sure that all listeners for a given phase\n   * are executed before calling the listeners of the next phase.\n   * @private\n   */\n  DocumentVisibilityMonitor.prototype._emitVisible = function (isVisible) {\n    var _this = this;\n    var promise = Promise.resolve();\n    var _loop_1 = function (phase) {\n      promise = promise.then(function () {\n        return _this._emitVisiblePhase(phase, isVisible);\n      });\n    };\n    for (var phase = 1; phase <= this._listeners.length; phase++) {\n      _loop_1(phase);\n    }\n    return promise;\n  };\n  /**\n   * Call all the listeners for a given phase.\n   * @private\n   */\n  DocumentVisibilityMonitor.prototype._emitVisiblePhase = function (phase, isVisible) {\n    var phaseListeners = this._listeners[phase - 1];\n    return Promise.all(phaseListeners.map(function (listener) {\n      var ret = listener(isVisible);\n      return ret instanceof Promise ? ret : Promise.resolve(ret);\n    }));\n  };\n  /**\n   * Start listening to the DOM visibility state change.\n   * @private\n   */\n  DocumentVisibilityMonitor.prototype._start = function () {\n    document.addEventListener('visibilitychange', this._onVisibilityChange);\n  };\n  /**\n   * Stop listening to the DOM visibility state change.\n   * @private\n   */\n  DocumentVisibilityMonitor.prototype._stop = function () {\n    document.removeEventListener('visibilitychange', this._onVisibilityChange);\n  };\n  /**\n   * Listen for the DOM visibility changes at the given phase.\n   * @param {number} phase\n   * @param {function} listener\n   * @returns {this}\n   */\n  DocumentVisibilityMonitor.prototype.onVisibilityChange = function (phase, listener) {\n    if (typeof phase !== 'number' || phase <= 0 || phase > this._listeners.length) {\n      throw new Error('invalid phase: ', phase);\n    }\n    var phaseListeners = this._listeners[phase - 1];\n    phaseListeners.push(listener);\n    if (this._listenerCount() === 1) {\n      this._start();\n    }\n    return this;\n  };\n  /**\n   * Stop listening for the DOM visibility change at the given phase.\n   * @param {number} phase\n   * @param {function} listener\n   * @returns {this}\n   */\n  DocumentVisibilityMonitor.prototype.offVisibilityChange = function (phase, listener) {\n    if (typeof phase !== 'number' || phase <= 0 || phase > this._listeners.length) {\n      throw new Error('invalid phase: ', phase);\n    }\n    var phaseListeners = this._listeners[phase - 1];\n    var index = phaseListeners.indexOf(listener);\n    if (index !== -1) {\n      phaseListeners.splice(index, 1);\n      if (this._listenerCount() === 0) {\n        this._stop();\n      }\n    }\n    return this;\n  };\n  return DocumentVisibilityMonitor;\n}();\nmodule.exports = new DocumentVisibilityMonitor(2);","map":{"version":3,"names":["DocumentVisibilityMonitor","nPhases","_this","Object","defineProperties","_listeners","value","_onVisibilityChange","_emitVisible","document","visibilityState","i","push","prototype","clear","length","_listenerCount","reduce","count","phaseListeners","isVisible","promise","Promise","resolve","phase","then","_emitVisiblePhase","all","map","listener","ret","_start","addEventListener","_stop","removeEventListener","onVisibilityChange","Error","offVisibilityChange","index","indexOf","splice","module","exports"],"sources":["/home/denis/RiderProjects/ChatRoulette/WebUI/chat-app/node_modules/twilio-video/lib/util/documentvisibilitymonitor.js"],"sourcesContent":["'use strict';\n\n/**\n * The {@link DocumentVisibilityMonitor} monitors the visibility state of the DOM\n * and executes the attached listeners in phase order when the DOM is visible.\n */\nclass DocumentVisibilityMonitor {\n  /**\n   * Constructor.\n   * @param {number} [nPhases=1] - the number of phases\n   */\n  constructor(nPhases = 1) {\n    Object.defineProperties(this, {\n      _listeners: {\n        value: []\n      },\n      _onVisibilityChange: {\n        value: () => {\n          this._emitVisible(document.visibilityState === 'visible');\n        }\n      }\n    });\n\n    for (let i = 0; i < nPhases; i++) {\n      this._listeners.push([]);\n    }\n  }\n\n\n  /**\n   * clears the state.\n   */\n  clear() {\n    const nPhases = this._listeners.length;\n    for (let i = 0; i < nPhases; i++) {\n      this._listeners[i] = [];\n    }\n  }\n\n  _listenerCount() {\n    return this._listeners.reduce((count, phaseListeners) => count + phaseListeners.length, 0);\n  }\n\n  /**\n   * Call all the listeners. Makes sure that all listeners for a given phase\n   * are executed before calling the listeners of the next phase.\n   * @private\n   */\n  _emitVisible(isVisible) {\n    let promise = Promise.resolve();\n    for (let phase = 1; phase <= this._listeners.length; phase++) {\n      promise = promise.then(() => this._emitVisiblePhase(phase, isVisible));\n    }\n    return promise;\n  }\n\n  /**\n   * Call all the listeners for a given phase.\n   * @private\n   */\n  _emitVisiblePhase(phase, isVisible) {\n    const phaseListeners = this._listeners[phase - 1];\n    return Promise.all(phaseListeners.map(listener => {\n      const ret = listener(isVisible);\n      return ret instanceof Promise ? ret : Promise.resolve(ret);\n    }));\n  }\n\n  /**\n   * Start listening to the DOM visibility state change.\n   * @private\n   */\n  _start() {\n    document.addEventListener('visibilitychange', this._onVisibilityChange);\n  }\n\n  /**\n   * Stop listening to the DOM visibility state change.\n   * @private\n   */\n  _stop() {\n    document.removeEventListener('visibilitychange', this._onVisibilityChange);\n  }\n\n  /**\n   * Listen for the DOM visibility changes at the given phase.\n   * @param {number} phase\n   * @param {function} listener\n   * @returns {this}\n   */\n  onVisibilityChange(phase, listener) {\n    if (typeof phase !== 'number' || phase <= 0 || phase > this._listeners.length) {\n      throw new Error('invalid phase: ', phase);\n    }\n    const phaseListeners = this._listeners[phase - 1];\n    phaseListeners.push(listener);\n    if (this._listenerCount() === 1) {\n      this._start();\n    }\n    return this;\n  }\n\n  /**\n   * Stop listening for the DOM visibility change at the given phase.\n   * @param {number} phase\n   * @param {function} listener\n   * @returns {this}\n   */\n  offVisibilityChange(phase, listener) {\n    if (typeof phase !== 'number' || phase <= 0 || phase > this._listeners.length) {\n      throw new Error('invalid phase: ', phase);\n    }\n\n    const phaseListeners = this._listeners[phase - 1];\n    const index = phaseListeners.indexOf(listener);\n    if (index !== -1) {\n      phaseListeners.splice(index, 1);\n      if (this._listenerCount() === 0) {\n        this._stop();\n      }\n    }\n    return this;\n  }\n}\n\nmodule.exports = new DocumentVisibilityMonitor(2);\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
{"ast":null,"code":"/* eslint callback-return:0 */\n'use strict';\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar EventEmitter = require('events');\nvar nInstances = 0;\nvar MediaSignaling = /** @class */function (_super) {\n  __extends(MediaSignaling, _super);\n  /**\n   * Construct a {@link MediaSignaling}.\n   * @param {Promise<DataTrackReceiver>} getReceive\n   * @param {string} channel\n   */\n  function MediaSignaling(getReceiver, channel, options) {\n    var _this = _super.call(this) || this;\n    Object.defineProperties(_this, {\n      _instanceId: {\n        value: nInstances++\n      },\n      channel: {\n        value: channel\n      },\n      _log: {\n        value: options.log.createLog('default', _this)\n      },\n      _getReceiver: {\n        value: getReceiver\n      },\n      _receiverPromise: {\n        value: null,\n        writable: true\n      },\n      _transport: {\n        value: null,\n        writable: true\n      }\n    });\n    return _this;\n  }\n  Object.defineProperty(MediaSignaling.prototype, \"isSetup\", {\n    get: function () {\n      return !!this._receiverPromise;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  MediaSignaling.prototype.toString = function () {\n    return \"[MediaSignaling #\" + this._instanceId + \":\" + this.channel + \"]\";\n  };\n  MediaSignaling.prototype.setup = function (id) {\n    var _this = this;\n    this._teardown();\n    this._log.info('setting up msp transport for id:', id);\n    var receiverPromise = this._getReceiver(id).then(function (receiver) {\n      if (receiver.kind !== 'data') {\n        _this._log.error('Expected a DataTrackReceiver');\n      }\n      if (_this._receiverPromise !== receiverPromise) {\n        return;\n      }\n      try {\n        _this._transport = receiver.toDataTransport();\n        _this.emit('ready', _this._transport);\n      } catch (ex) {\n        _this._log.error(\"Failed to toDataTransport: \" + ex.message);\n      }\n      receiver.once('close', function () {\n        return _this._teardown();\n      });\n    });\n    this._receiverPromise = receiverPromise;\n  };\n  MediaSignaling.prototype._teardown = function () {\n    if (this._transport) {\n      this._log.info('Tearing down');\n      this._transport = null;\n      this._receiverPromise = null;\n      this.emit('teardown');\n    }\n  };\n  return MediaSignaling;\n}(EventEmitter);\nmodule.exports = MediaSignaling;","map":{"version":3,"names":["EventEmitter","require","nInstances","MediaSignaling","_super","__extends","getReceiver","channel","options","_this","call","Object","defineProperties","_instanceId","value","_log","log","createLog","_getReceiver","_receiverPromise","writable","_transport","defineProperty","prototype","get","toString","setup","id","_teardown","info","receiverPromise","then","receiver","kind","error","toDataTransport","emit","ex","message","once","module","exports"],"sources":["/home/denis/RiderProjects/ChatRoulette/WebUI/chat-app/node_modules/twilio-video/lib/signaling/v2/mediasignaling.js"],"sourcesContent":["/* eslint callback-return:0 */\n'use strict';\n\nconst EventEmitter = require('events');\n\nlet nInstances = 0;\nclass MediaSignaling extends EventEmitter {\n  /**\n   * Construct a {@link MediaSignaling}.\n   * @param {Promise<DataTrackReceiver>} getReceive\n   * @param {string} channel\n   */\n  constructor(getReceiver, channel, options) {\n    super();\n    Object.defineProperties(this, {\n      _instanceId: {\n        value: nInstances++\n      },\n      channel: {\n        value: channel,\n      },\n      _log: {\n        value: options.log.createLog('default', this)\n      },\n      _getReceiver: {\n        value: getReceiver\n      },\n      _receiverPromise: {\n        value: null,\n        writable: true,\n      },\n      _transport: {\n        value: null,\n        writable: true\n      }\n    });\n  }\n\n  get isSetup() {\n    return !!this._receiverPromise;\n  }\n\n  toString() {\n    return `[MediaSignaling #${this._instanceId}:${this.channel}]`;\n  }\n\n  setup(id) {\n    this._teardown();\n    this._log.info('setting up msp transport for id:', id);\n    const receiverPromise = this._getReceiver(id).then(receiver => {\n      if (receiver.kind !== 'data') {\n        this._log.error('Expected a DataTrackReceiver');\n      } if (this._receiverPromise !== receiverPromise) {\n        return;\n      }\n\n      try {\n        this._transport = receiver.toDataTransport();\n        this.emit('ready', this._transport);\n      } catch (ex) {\n        this._log.error(`Failed to toDataTransport: ${ex.message}`);\n      }\n      receiver.once('close', () => this._teardown());\n    });\n    this._receiverPromise = receiverPromise;\n  }\n\n  _teardown() {\n    if (this._transport) {\n      this._log.info('Tearing down');\n      this._transport = null;\n      this._receiverPromise = null;\n      this.emit('teardown');\n    }\n  }\n}\n\nmodule.exports = MediaSignaling;\n"],"mappings":"AAAA;AACA,YAAY;;;;;;;;;;;;;;;;;;;;;;AAEZ,IAAMA,YAAY,GAAGC,OAAO,CAAC,QAAQ,CAAC;AAEtC,IAAIC,UAAU,GAAG,CAAC;AAClB,IAAAC,cAAA,0BAAAC,MAAA;EAA6BC,SAAA,CAAAF,cAAA,EAAAC,MAAA;EAC3B;;;;;EAKA,SAAAD,eAAYG,WAAW,EAAEC,OAAO,EAAEC,OAAO;IAAzC,IAAAC,KAAA,GACEL,MAAA,CAAAM,IAAA,MAAO;IACPC,MAAM,CAACC,gBAAgB,CAACH,KAAI,EAAE;MAC5BI,WAAW,EAAE;QACXC,KAAK,EAAEZ,UAAU;OAClB;MACDK,OAAO,EAAE;QACPO,KAAK,EAAEP;OACR;MACDQ,IAAI,EAAE;QACJD,KAAK,EAAEN,OAAO,CAACQ,GAAG,CAACC,SAAS,CAAC,SAAS,EAAER,KAAI;OAC7C;MACDS,YAAY,EAAE;QACZJ,KAAK,EAAER;OACR;MACDa,gBAAgB,EAAE;QAChBL,KAAK,EAAE,IAAI;QACXM,QAAQ,EAAE;OACX;MACDC,UAAU,EAAE;QACVP,KAAK,EAAE,IAAI;QACXM,QAAQ,EAAE;;KAEb,CAAC;;EACJ;EAEAT,MAAA,CAAAW,cAAA,CAAInB,cAAA,CAAAoB,SAAA,WAAO;SAAX,SAAAC,CAAA;MACE,OAAO,CAAC,CAAC,IAAI,CAACL,gBAAgB;IAChC,CAAC;;;;EAEDhB,cAAA,CAAAoB,SAAA,CAAAE,QAAQ,GAAR;IACE,OAAO,sBAAoB,IAAI,CAACZ,WAAW,SAAI,IAAI,CAACN,OAAO,MAAG;EAChE,CAAC;EAEDJ,cAAA,CAAAoB,SAAA,CAAAG,KAAK,GAAL,UAAMC,EAAE;IAAR,IAAAlB,KAAA;IACE,IAAI,CAACmB,SAAS,EAAE;IAChB,IAAI,CAACb,IAAI,CAACc,IAAI,CAAC,kCAAkC,EAAEF,EAAE,CAAC;IACtD,IAAMG,eAAe,GAAG,IAAI,CAACZ,YAAY,CAACS,EAAE,CAAC,CAACI,IAAI,CAAC,UAAAC,QAAQ;MACzD,IAAIA,QAAQ,CAACC,IAAI,KAAK,MAAM,EAAE;QAC5BxB,KAAI,CAACM,IAAI,CAACmB,KAAK,CAAC,8BAA8B,CAAC;;MAC/C,IAAIzB,KAAI,CAACU,gBAAgB,KAAKW,eAAe,EAAE;QAC/C;;MAGF,IAAI;QACFrB,KAAI,CAACY,UAAU,GAAGW,QAAQ,CAACG,eAAe,EAAE;QAC5C1B,KAAI,CAAC2B,IAAI,CAAC,OAAO,EAAE3B,KAAI,CAACY,UAAU,CAAC;OACpC,CAAC,OAAOgB,EAAE,EAAE;QACX5B,KAAI,CAACM,IAAI,CAACmB,KAAK,CAAC,gCAA8BG,EAAE,CAACC,OAAS,CAAC;;MAE7DN,QAAQ,CAACO,IAAI,CAAC,OAAO,EAAE;QAAM,OAAA9B,KAAI,CAACmB,SAAS,EAAE;MAAhB,CAAgB,CAAC;IAChD,CAAC,CAAC;IACF,IAAI,CAACT,gBAAgB,GAAGW,eAAe;EACzC,CAAC;EAED3B,cAAA,CAAAoB,SAAA,CAAAK,SAAS,GAAT;IACE,IAAI,IAAI,CAACP,UAAU,EAAE;MACnB,IAAI,CAACN,IAAI,CAACc,IAAI,CAAC,cAAc,CAAC;MAC9B,IAAI,CAACR,UAAU,GAAG,IAAI;MACtB,IAAI,CAACF,gBAAgB,GAAG,IAAI;MAC5B,IAAI,CAACiB,IAAI,CAAC,UAAU,CAAC;;EAEzB,CAAC;EACH,OAAAjC,cAAC;AAAD,CAAC,CArE4BH,YAAY;AAuEzCwC,MAAM,CAACC,OAAO,GAAGtC,cAAc"},"metadata":{},"sourceType":"script","externalDependencies":[]}